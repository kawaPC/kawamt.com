---
title: ブログを作る⑤ - "続きを読む"の実装
---

![記事ソースのMarkdownファイル](https://cdn-ak.f.st-hatena.com/images/fotolife/h/hachipochi/20210722/20210722184351.png "記事の元になったMarkdownファイル")

これはブログサービスでは馴染みの機能で、ざっくり言うと

「"続きを読む"のリンクを踏むと記事単体ページに飛び、一覧では隠れていた記事の本文が表示される」

というもの。

大した工夫はしてないが、このサイトではどう実装しているかを紹介する。

***

### 前文と本文を分ける記号を決める

まず、元は前後分かれてない一つの記事ファイルなので、記事一覧で表示する前文とそれ以外を分ける改ページ記号を定義する必要がある。

そこで、複数ある水平線(horizontal)を引く記法のうちの一つを改ページ用の記号として扱う作戦で行くことにした。
普通に水平線を引きたい場合は`---`の記法を使い、改ページをする場合は`***`を使う。

そして、記事単体ページでは改ページの記号として使った`***`は省かず表示する。
前述の通り`***`は水平線の記法なので、これはこれで前文と本文の境目が分かりやすくなって都合が良い。

![記事ページでは水平線として表示される](https://cdn-ak.f.st-hatena.com/images/fotolife/h/hachipochi/20210722/20210722145957.png "記事ページでは水平線として表示される")

### 前文だけが載った記事一覧を作る

`split`で前文と本文に分け、前者を渡してビルドにかければ、簡単に前文だけが表示される記事一覧を作ることができる。

```ts
// `***`を分岐点に前文と本文を分け、前文だけをRemarkの変換にかけて記事一覧へ出力する
const [introduction, body] = content.split("***");
const introductionSource = await markdownToHtml(introduction);

// "続きを読む"のリンクを表示するかどうかのフラグに使う
const isShort = !body
```

また、改ページ記号がなければ、`introduction`に全文が入ることになり、"続きを読む"がない、短い記事が生成される。
